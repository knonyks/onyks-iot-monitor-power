.subckt ACS37002 IP+ IP- GAIN_SEl_0 GAIN_SEl_1 DUT_GND Viout FAULT VCC VOC VREF
Rp IP+ 0 R={package_resistance}
XSet_BW N002 front_end N002 opamp Aol=100K GBW=400k
B§OutputStage front_end DUT_GND V=if({polarity}==2,((V(IP+)-V(0))/{package_resistance}*(if(V(GAIN_SEl_0)==0&V(GAIN_SEl_1)==0, {sens1}, if(V(GAIN_SEl_0)==0&V(GAIN_SEl_1)==V(VCC), {sens2}, if(V(GAIN_SEl_0)==V(VCC)&V(GAIN_SEl_1)==0, {sens3}, {sens4})))))+if(VCC_typ==5, 2.5,1.65), ((V(IP+)-V(0))/0.27m*(if(V(GAIN_SEl_0)==0&V(GAIN_SEl_1)==0, {sens1}, if(V(GAIN_SEl_0)==0&V(GAIN_SEl_1)==V(VCC), {sens2}, if(V(GAIN_SEl_0)==V(VCC)&V(GAIN_SEl_1)==0, {sens3}, {sens4})))))+if(VCC_typ==5, 0.5,0.33))
B§Set_VREF VREF DUT_GND V=if((V(VCC)>=4.5)&(V(VCC)<=5.5), if({polarity}==2, 2.5, 0.5),if((V(VCC)>=3)&(V(VCC)<=3.6), if({polarity}==2, 1.65, 0.33),0))
B§VSat_High N001 DUT_GND V=V(VCC)-0.3
VSat_Low N003 DUT_GND 150mV
XBuffer N002 Viout N001 N003 Viout level2 Avol=1Meg GBW=10Meg Slew=10Meg Ilimit=25m Rail=0 Vos=0 En=0 Enk=0 In=0 Ink=0 Rin=500Meg
B1 DUT_GND VCC I=if({VCC_typ}==5, 13mA, 12mA)
M1 FAULT N004 DUT_GND N005 NMOS l=.4u w=70u
B§Set_Fault_Response N004 DUT_GND V=delay(V(OUT), 1.5u)
B§Compare1 N006 DUT_GND V=if(abs(I(Rp))>=if(V(VOC)>0.2,V(VOC),if({polarity}==1,0.5,1))*(if(V(GAIN_SEl_0)==0&V(GAIN_SEl_1)==0, if({VCC_typ}==5, 2, 1.32)/{sens1}, if(V(GAIN_SEl_0)==0&V(GAIN_SEl_1)==V(VCC), if({VCC_typ}==5, 2, 1.32)/{sens2}, if(V(GAIN_SEl_0)==V(VCC)&V(GAIN_SEl_1)==0, if({VCC_typ}==5, 2, 1.32)/{sens3}, if({VCC_typ}==5, 2, 1.32)/{sens4})))), V(VCC), 0)
A1 N006 N007 0 0 0 0 OUT 0 SRFLOP Vhigh=3.3
B§Compare2 N007 DUT_GND V=if(abs(I(Rp))<=if(V(VOC)>0.2,V(VOC),if({polarity}==1,0.5,1))*(if(V(GAIN_SEl_0)==0&V(GAIN_SEl_1)==0, if({VCC_typ}==5, 2, 1.32)/{sens1}, if(V(GAIN_SEl_0)==0&V(GAIN_SEl_1)==V(VCC), if({VCC_typ}==5, 2, 1.32)/{sens2}, if(V(GAIN_SEl_0)==V(VCC)&V(GAIN_SEl_1)==0, if({VCC_typ}==5, 2, 1.32)/{sens3}, if({VCC_typ}==5, 2, 1.32)/{sens4}))))-(if(V(GAIN_SEl_0)==0&V(GAIN_SEl_1)==0, if({VCC_typ}==5, 2, 1.32)/{sens1}, if(V(GAIN_SEl_0)==0&V(GAIN_SEl_1)==V(VCC), if({VCC_typ}==5, 2, 1.32)/{sens2}, if(V(GAIN_SEl_0)==V(VCC)&V(GAIN_SEl_1)==0, if({VCC_typ}==5, 2, 1.32)/{sens3}, if({VCC_typ}==5, 2, 1.32)/{sens4}))))*if({VCC_typ==5},0.06, 0.09), V(VCC), 0)
.model NMOS NMOS
.model PMOS PMOS
.lib opamp.sub
.lib UniversalOpAmp2.lib
.backanno
.ends ACS37002
.end
